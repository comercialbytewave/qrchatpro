# Docker Compose para produção no EasyPanel
# Usa imagens pré-construídas do Docker Hub
# PostgreSQL e Redis rodam separadamente no EasyPanel

services:
  # Backend
  backend:
    image: lucasricarte/beqrchatpro:latest
    restart: always
    expose:
      - "8089"
    environment:
      - NODE_ENV=production
      - BACKEND_URL=https://qrchat.bytewave.com.br/api
      - FRONTEND_URL=https://qrchat.bytewave.com.br
      - PORT=8089
      # Banco de dados (ajuste conforme seu EasyPanel)
      - DB_DIALECT=postgres
      - DB_HOST=54.144.207.128
      - DB_PORT=5432
      - DB_USER=postgres
      - DB_PASS=Wa@13851424
      - DB_NAME=wpp
      # Auth
      - JWT_SECRET=kZaOTd+YZpjRUyyuQUpigJaEMk4vcW4YOymKPZX0Ts8=
      - JWT_REFRESH_SECRET=dBSXqFg9TaNUEDXVp6fhMTRLBysP+j2DSqf7+raxD3A=
      # Redis (ajuste conforme seu EasyPanel)
      - REDIS_URI=redis://default:13851424@54.144.207.128:6379
      - REDIS_OPT_LIMITER_MAX=1
      - REDIS_OPT_LIMITER_DURATION=3000
      # Limites
      - USER_LIMIT=10000
      - CONNECTIONS_LIMIT=100000
      - CLOSED_SEND_BY_ME=true
      # Meta/Facebook
      - VERIFY_TOKEN=whaticket
      - FACEBOOK_APP_ID=1415386853487738
      - FACEBOOK_APP_SECRET=b9886bfcab47ca4d0bfe1e44a1b37a60
      # Email
      - MAIL_HOST=smtp.gmail.com
      - MAIL_USER=comercialbytewave@gmail.com
      - MAIL_PASS=Wa@13851424
      - MAIL_FROM=comercialbytewave@gmail.com
      - MAIL_PORT=467
    volumes:
      - backend_public:/usr/src/app/public

  # Frontend
  frontend:
    image: lucasricarte/feqrchatpro:latest
    restart: always
    expose:
      - "3008"
    depends_on:
      - backend

volumes:
  backend_public:
