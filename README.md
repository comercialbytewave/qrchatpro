<img src="https://imgur.com/a/ZqRDnPP" />

## ğŸš€ QRChat: O Futuro da ComunicaÃ§Ã£o com Clientes

Experimente gratuitamente o QRChat, o sistema de tickets via WhatsApp que transforma seu atendimento e te coloca no controle total!

Com o QRChat, vocÃª nÃ£o apenas gerencia; vocÃª automatiza e escala com as ferramentas mais poderosas do mercado:

1ï¸âƒ£ - AutomaÃ§Ã£o de Elite: IntegraÃ§Ã£o nativa e poderosa com DialogFlow, n8n, Typebot, WebHooks, Facebook, Instagram e um Construtor de Fluxos visual e intuitivo para Chatbot.

2ï¸âƒ£ - Recomendado por Especialistas: Desenvolvido por lÃ­deres em automaÃ§Ã£o e atendimento, o QRChat Ã© a escolha dos profissionais que priorizam a eficiÃªncia e a excelÃªncia.

3ï¸âƒ£ - Foco Total no Cliente: Diga adeus ao caos de gerenciar mÃºltiplos canais. Nosso sistema Ã© projetado para simplificar sua rotina, permitindo que sua equipe se concentre no que realmente importa: oferecer uma experiÃªncia de atendimento 5 estrelas.

Pare de perder tempo com processos complexos. Descubra a agilidade, a integraÃ§Ã£o e o poder do QRChat hoje mesmo.

<br /><br />

## ğŸ“Œ IntegraÃ§Ãµes

<img src="https://i.postimg.cc/CxJmZYZk/Group-26.png" />

<br /><br />

## ğŸ”§ Requisitos

<img src="https://i.postimg.cc/kGRpDYJC/Group-27.png" style="height: 250px;" />

<nav>
  <ul>
    <li>SubdomÃ­nio para Frontend: https://qrchat.bytewave.com.br</li>
    <li>SubdomÃ­nio para API (Backend): https://qrchat.bytewave.com.br/api</li>
  </ul>
</nav>

<br /><br />

## ğŸ’¿ InstalaÃ§Ã£o

EsqueÃ§a as guias de instalaÃ§Ã£o! Com o QRChat, vocÃª se cadastra e opera diretamente. Simples assim.

<br /><br />

## â­ Recursos

âœ¨ IntegraÃ§Ã£o com o Pixel do Facebook: Acompanhe e registre conversÃµes com o pixel do Facebook    
âœ¨ IntegraÃ§Ã£o com Webhook: Utilize webhooks para conectar com outros sistemas e automatizar processos   
âœ¨ Construtor De Fluxos Para Chatbot     
âœ¨ Atendentes   
âœ¨ Modo Claro/Escuro    
âœ¨ Cores Personalizadas  
âœ¨ Logotipo/Marca PrÃ³pria  
âœ¨ Aplicativo PWA  
âœ¨ DomÃ­nio PrÃ³prio  
âœ¨ Cores Personalizadas  
âœ¨ Logotipo / Marca PrÃ³pria  
âœ¨ Aplicativo PWA  
âœ¨ Dashboard  
âœ¨ EstatÃ­sticas  
âœ¨ Mensagens Agendadas com Anexo  
âœ¨ Respostas RÃ¡pidas com Anexo  
âœ¨ Agendamento Recorrente  
âœ¨ Campanhas Recorrentes  
âœ¨ Carteira de Cliente  
âœ¨ Gerenciamento de Grupos  
âœ¨ Chat Interno  
âœ¨ Tarefas  
âœ¨ Campanhas  
âœ¨ Ãudio Gravado na Hora  
âœ¨ Setores & Filas  
âœ¨ RecuperaÃ§Ã£o de Senha por E-Mail

<br /><br />

## âœ… Recursos via API

ğŸŸ¢ Atualizar Contatos  
ğŸŸ¢ Atualizar Tickets  
ğŸŸ¢ Criar Agendamento  
ğŸŸ¢ Criar Contatos  
ğŸŸ¢ Criar Empresas  
ğŸŸ¢ Criar Tags  
ğŸŸ¢ Enviar Mensagens  
ğŸŸ¢ Excluir Agendamento  
ğŸŸ¢ Excluir Contatos  
ğŸŸ¢ Excluir Tags  
ğŸŸ¢ Listar Agendamento  
ğŸŸ¢ Listar Contatos  
ğŸŸ¢ Listar Tags

<br /><br />

## âš ï¸ IsenÃ§Ã£o de Responsabilidade

Este projeto nÃ£o Ã© afiliado, associado, autorizado, endossado ou de qualquer forma oficialmente conectado ao WhatsApp ou a qualquer uma de suas subsidiÃ¡rias ou afiliadas. O site oficial do WhatsApp pode ser encontrado em https://whatsapp.com. â€œWhatsAppâ€, bem como nomes, marcas, emblemas e imagens relacionados sÃ£o marcas registradas de seus respectivos proprietÃ¡rios.

<br /><br />

## ğŸ“ Github

Codigo baseado no Whaticket Community de:
<nav>
  <ul>
    <li><a href="https://github.com/canove/whaticket-community" target="_blank">Cassio Santos no GitHub</a></li>

<br /><br />

## ğŸ› ï¸ Com as seguintes Ferramentas de Apoio:
<nav>
    <li><a href="https://github.com/WhiskeySockets/Baileys" target="_blank">Baileys - WhatsApp Web API</a></li>
    <li><a href="https://github.com/redis/redis" target="_blank">Redis</a></li>
    <li><a href="https://github.com/postgres/postgres" target="_blank">PostgreSQL</a></li>
    <li><a href="https://github.com/docker" target="_blank">Docker</a></li>
    <li><a href="https://github.com/nginx/nginx" target="_blank">Nginx</a></li>
    <li><a href="https://github.com/nodejs/node" target="_blank">Node</a></li>
    <li><a href="https://github.com/Unitech/pm2" target="_blank">PM2</a></li>
    <li><a href="https://github.com/certbot/certbot" target="_blank">Certbot</a></li>
  </ul>
</nav>

# WhatsApp Cloud Services

Esta pasta contÃ©m serviÃ§os adaptados para usar a **API oficial do WhatsApp (WhatsApp Cloud API)** ao invÃ©s da biblioteca Baileys.

## Estrutura de Arquivos

### Arquivos Principais

- **StartWhatsAppCloudSession.ts**: Inicializa uma sessÃ£o usando a API oficial do WhatsApp. NÃ£o requer QR code, apenas token e phoneNumberId.

- **SendWhatsAppCloudMessage.ts**: Envia mensagens de texto usando a API oficial do WhatsApp.

- **SendWhatsAppCloudMedia.ts**: Envia mÃ­dias (imagens, vÃ­deos, Ã¡udios, documentos) usando a API oficial.

- **whatsAppCloudMessageProcessor.ts**: Processador principal de mensagens recebidas via webhooks da API oficial do WhatsApp. ContÃ©m todas as funÃ§Ãµes para processar mensagens, mÃ­dias, contatos, tickets, filas e chatbot.

- **whatsAppCloudMessageListener.ts**: Arquivo legado mantido para compatibilidade. O processamento principal estÃ¡ em `whatsAppCloudMessageProcessor.ts`.

- **whatsAppCloudMonitor.ts**: Monitora o status da conexÃ£o e verifica periodicamente a validade do token.

### Arquivos Auxiliares

- **CheckNumber.ts**: Verifica se um nÃºmero Ã© vÃ¡lido (adaptado para API oficial).

- **CheckIsValidContact.ts**: Verifica se um contato Ã© vÃ¡lido.

- **GetProfilePicUrl.ts**: ObtÃ©m URL da foto de perfil (TODO: implementar quando disponÃ­vel na API).

- **DeleteWhatsAppCloudMessage.ts**: Deleta mensagens usando a API oficial.

- **MarkDeleteWhatsAppCloudMessage.ts**: Marca mensagens como deletadas quando recebidas via webhook.

- **SendWhatsAppCloudMessageAPI.ts**: VersÃ£o simplificada para uso via API externa.

- **StartAllWhatsAppCloudSessions.ts**: Inicia todas as sessÃµes WhatsApp Cloud de uma empresa.

## DiferenÃ§as Principais em RelaÃ§Ã£o ao WbotServices

1. **NÃ£o usa WebSocket**: A API oficial usa webhooks HTTP para receber mensagens e requisiÃ§Ãµes HTTP para enviar.

2. **NÃ£o precisa de QR Code**: A autenticaÃ§Ã£o Ã© feita via token de acesso permanente.

3. **Requere ConfiguraÃ§Ã£o Adicional**: 
   - `token`: Token de acesso da API do WhatsApp
   - `phoneNumberId`: ID do nÃºmero de telefone na API do WhatsApp

4. **Webhooks**: Ã‰ necessÃ¡rio configurar um endpoint para receber webhooks do WhatsApp.

## Como Usar

### 1. Configurar o WhatsApp no Banco de Dados

Certifique-se de que o registro do WhatsApp tenha:
- `token`: Token de acesso da API
- `phoneNumberId`: ID do nÃºmero de telefone
- `channel`: "whatsapp" ou "whatsapp-cloud"

### 2. Configurar Webhook

VocÃª precisarÃ¡ criar um controller para receber os webhooks do WhatsApp. Exemplo:

```typescript
import { processWhatsAppCloudWebhook } from "../services/WhatsAppCloudServices/whatsAppCloudMessageProcessor";

export const webhook = async (req: Request, res: Response) => {
  // VerificaÃ§Ã£o do webhook (GET)
  if (req.method === "GET") {
    const mode = req.query["hub.mode"];
    const token = req.query["hub.verify_token"];
    const challenge = req.query["hub.challenge"];
    
    if (mode === "subscribe" && token === process.env.WEBHOOK_VERIFY_TOKEN) {
      return res.status(200).send(challenge);
    }
    return res.sendStatus(403);
  }

  // Processamento de mensagens (POST)
  if (req.method === "POST") {
    const webhookData = req.body;
    await processWhatsAppCloudWebhook(webhookData, companyId);
    return res.sendStatus(200);
  }
};
```

### 3. Iniciar SessÃ£o

```typescript
import { StartWhatsAppCloudSession } from "./services/WhatsAppCloudServices/StartWhatsAppCloudSession";

await StartWhatsAppCloudSession(whatsapp, companyId);
```

## Notas Importantes

- A API oficial do WhatsApp tem limites de taxa (rate limits).
- Algumas funcionalidades podem nÃ£o estar disponÃ­veis na API oficial (ex: foto de perfil).
- Os webhooks devem ser configurados no painel do Facebook/Meta.
- O token pode expirar e precisar ser renovado.

## PrÃ³ximos Passos

1. Criar controller para webhooks
2. Implementar renovaÃ§Ã£o automÃ¡tica de tokens
3. Adicionar tratamento de erros especÃ­ficos da API oficial
4. Implementar funcionalidades adicionais conforme necessÃ¡rio




# ImplementaÃ§Ã£o do Campo phoneNumberId para WhatsApp Cloud API

## AlteraÃ§Ãµes Realizadas

### 1. Modelo Whatsapp (`backend/src/models/Whatsapp.ts`)
- âœ… Adicionado campo `phoneNumberId` do tipo `TEXT` e `AllowNull(true)`
- Campo posicionado apÃ³s `token` para manter organizaÃ§Ã£o lÃ³gica

### 2. Migration (`backend/src/database/migrations/20251106152140-add-phoneNumberId-to-whatsapps.ts`)
- âœ… Criada migration para adicionar coluna `phoneNumberId` na tabela `Whatsapps`
- Tipo: `TEXT`
- Permite `NULL` (para compatibilidade com WhatsApps existentes)
- Inclui mÃ©todo `down` para rollback

### 3. Services Atualizados

#### CreateWhatsAppService (`backend/src/services/WhatsappService/CreateWhatsAppService.ts`)
- âœ… Adicionado `phoneNumberId` na interface `Request`
- âœ… Adicionado parÃ¢metro na funÃ§Ã£o
- âœ… IncluÃ­do no `Whatsapp.create()`

#### UpdateWhatsAppService (`backend/src/services/WhatsappService/UpdateWhatsAppService.ts`)
- âœ… Adicionado `phoneNumberId` na interface `WhatsappData`
- âœ… Adicionado na desestruturaÃ§Ã£o
- âœ… IncluÃ­do no `whatsapp.update()`

#### UpdateWhatsAppServiceAdmin (`backend/src/services/WhatsappService/UpdateWhatsAppServiceAdmin.ts`)
- âœ… Adicionado `phoneNumberId` na interface `WhatsappData`
- âœ… Adicionado na desestruturaÃ§Ã£o
- âœ… IncluÃ­do no `whatsapp.update()`

### 4. Controllers Atualizados

#### WhatsAppCloudController (`backend/src/controllers/WhatsAppCloudController.ts`)
- âœ… Removido cÃ³digo redundante de update manual
- âœ… Agora usa os services corretamente que jÃ¡ incluem `phoneNumberId`

## Como Executar a Migration

Para aplicar a migration no banco de dados:

```bash
cd backend
npm run db:migrate
```

Ou usando o Sequelize CLI diretamente:

```bash
cd backend
npx sequelize db:migrate
```

## Estrutura do Campo

```typescript
@AllowNull(true)
@Column(DataType.TEXT)
phoneNumberId: string;
```

- **Tipo**: TEXT (permite strings longas)
- **Nullable**: Sim (para compatibilidade com WhatsApps existentes)
- **Default**: null

## VerificaÃ§Ã£o

ApÃ³s executar a migration, vocÃª pode verificar se a coluna foi criada:

```sql
-- PostgreSQL
SELECT column_name, data_type, is_nullable 
FROM information_schema.columns 
WHERE table_name = 'Whatsapps' AND column_name = 'phoneNumberId';

-- MySQL
DESCRIBE Whatsapps;
```

## Notas Importantes

1. O campo Ã© opcional e permite `NULL` para manter compatibilidade com WhatsApps existentes
2. Apenas WhatsApps Cloud API terÃ£o este campo preenchido
3. A migration pode ser revertida usando `npm run db:migrate:undo`


<br /><br />

## ğŸ™‹ Suporte e Contato

Entre em contato atravÃ©s do <a href="https://wa.me/5585992795219" target="_blank">Whatsapp</a> ou <a href="mailto:comercialbytewave@gmail.com" target="_blank">E-mail</a>.