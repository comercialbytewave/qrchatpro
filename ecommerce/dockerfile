# ------------------------
# 1. Build stage
# ------------------------
FROM node:20-alpine AS builder
 
# Diretório de trabalho
WORKDIR /app
 
# Copiar package.json e package-lock.json / yarn.lock
COPY package*.json ./
 
# Instalar dependências
RUN npm install --frozen-lockfile
 
# Copiar o restante do código
COPY . .
 
# Build da aplicação
RUN npm run build
 
# ------------------------
# 2. Production stage
# ------------------------
FROM node:20-alpine AS runner
 
WORKDIR /app
 
# Copiar apenas o necessário do build
COPY --from=builder /app/package*.json ./
COPY --from=builder /app/node_modules ./node_modules
COPY --from=builder /app/.next ./.next
COPY --from=builder /app/public ./public
COPY --from=builder /app/next.config.ts ./next.config.ts
 
# Variável de ambiente para produção
ENV NODE_ENV=production
 
# Expor a porta padrão do Next.js
EXPOSE 3000
 
# Comando para rodar a aplicação
CMD ["npm", "run", "start"]